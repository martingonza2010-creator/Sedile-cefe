<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.jpg" type="image/jpeg">
    <title>SEDILE HRA | Professional Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css?v=3.43">
    <link rel="manifest" href="manifest.json">
</head>

<body>
    <div class="bg-blob blob-1"></div>
    <div class="bg-blob blob-2"></div>

    <!-- PANTALLA DE ACCESO (LOGIN) -->
    <section id="auth-screen" class="auth-container">
        <div class="login-card">
            <img src="https://i.imgur.com/ugEhxa1.jpeg" alt="Logo NutriMartin" class="logo-entrance">
            <h1>Bienvenido a SEDILE - HRA</h1>
            <p>Portal de Apoyo Nutricional Cl√≠nico</p>
            <button id="btnLoginGoogle" class="btn-google" onclick="window.login()">
                <img src="https://cdn-icons-png.flaticon.com/512/2991/2991148.png" alt="G">
                Entrar con Google
            </button>
            <small>Creado por Nutricionista Martin E. Gonzalez</small>
        </div>
    </section>

    <!-- APLICACI√ìN PRINCIPAL (OCULTA HASTA LOGIN) -->
    <div id="main-app" class="app-container compact-mode" style="display:none;">

        <!-- Info Protocol Button (Hidden by default V3.43) -->
        <button class="protocol-fab" id="btnProtocolOpen" title="Protocolos Institucionales" style="display:none;">
            <span>i</span> Protocolos HRA
        </button>

        <!-- Bot√≥n Logout (Eliminado por redundancia y UI mobile) -->
        <!-- <button class="logout-btn" id="btnLogout" title="Cerrar Sesi√≥n">Salir</button> -->

        <header class="main-header">
            <div class="brand-box">
                <img src="https://i.imgur.com/ugEhxa1.jpeg" alt="Logo" class="logo-small">
                <div>
                    <h1>SEDILE - HRA</h1>
                    <p id="userNameDisplay">Calculadora Cl√≠nica</p>
                </div>
            </div>

            <div class="header-right-group">
                <!-- Protocols & Logout -->
                <div style="display:flex; gap:10px; align-items:center; margin-bottom:10px; justify-content: flex-end;">
                    <button class="btn-premium-toggle" id="btnOpenPurpose" title="Prop√≥sito y Protocolos">
                        <span>üìã Protocolos V.Infusion</span>
                    </button>
                    <button class="btn-premium-toggle" id="btnOpenWard" title="Vista Kanban de Sala"
                        style="background:var(--primary); color:white; border-color:white;">
                        <span>üè• Vista de Sala</span>
                    </button>
                    <button class="btn-icon-circle" id="btnLogoutHeader" title="Cerrar Sesi√≥n">üö™</button>
                </div>

                <div class="patient-quick-access" id="btnPatientToggle">
                    <div class="p-avatar" id="currentPatientAvatar">P</div>
                    <div class="p-info">
                        <span id="currentPatientName">Nuevo Paciente</span>
                        <small style="display:flex; align-items:center; gap:5px;">
                            IMC: <b id="valBMI">--</b>
                        </small>
                    </div>
                </div>
                <button class="btn-assess" id="btnOpenAssessment" style="display:none;">
                    <span>üìã</span> Evaluaci√≥n Completa
                </button>
            </div>
        </header>

        <!-- APP TABS NAVIGATION (NEW V3.7) -->
        <nav class="app-tabs">
            <button class="tab-btn active" data-view="dashboard">
                <span class="tab-icon">üìä</span> C√°lculo Nutricional
            </button>
            <button class="tab-btn" data-view="assessment">
                <span class="tab-icon">üìã</span> Evaluaci√≥n Completa
            </button>
            <button class="tab-btn" data-view="nutri-ia">
                <span class="tab-icon">ü¶¶</span> Nutri IA
            </button>
        </nav>

        <!-- VISTA DASHBOARD (PRINCIPAL) -->
        <div id="view-dashboard" class="view-section active-view">
            <main class="dashboard-grid">
                <!-- SECCI√ìN 1: EVALUACI√ìN R√ÅPIDA -->
                <section class="card assessment-card">
                    <div class="card-header">
                        <h3>Registro Evaluaci√≥n</h3>
                        <div class="header-actions">
                            <button class="btn-micro" id="btnOpenHistory">üìÇ Historial</button>
                            <button class="btn-micro" id="btnAddPatient">+ Nuevo</button>
                        </div>
                    </div>
                    <form id="form-paciente" class="compact-form">
                        <div class="input-row">
                            <input type="text" id="nombre" placeholder="Nombre completo" required>
                        </div>
                        <!-- NEW: Diagnosis & Bed -->
                        <div class="input-row grid-col-2">
                            <input type="text" id="diagnostico" placeholder="Diagn√≥stico" style="font-size:0.85rem;">
                            <input type="text" id="cama" placeholder="Cama / Sala" style="font-size:0.85rem;">
                        </div>

                        <div class="grid-col-4">
                            <div class="mini-input">
                                <label>Edad</label>
                                <input type="number" id="edad" placeholder="0">
                            </div>
                            <div class="mini-input">
                                <label>Sexo</label>
                                <select id="sexo">
                                    <option value="m">M</option>
                                    <option value="f">F</option>
                                </select>
                            </div>
                            <div class="mini-input">
                                <label>Peso (kg)</label>
                                <input type="number" step="0.1" id="peso" placeholder="0">
                            </div>
                            <div class="mini-input">
                                <label>Talla (m)</label>
                                <input type="number" step="0.01" id="estatura" placeholder="0">
                            </div>
                        </div>

                        <!-- NEW V3.19: Ideal Weight & IPT Row -->
                        <div class="grid-col-2" style="margin-top:10px; gap:10px;">
                            <div
                                style="background:rgba(52, 152, 219, 0.05); padding:8px; border-radius:8px; border:1px solid rgba(52, 152, 219, 0.1);">
                                <span
                                    style="font-size:0.6rem; color:#888; display:block; text-transform:uppercase; letter-spacing:0.5px;">Peso
                                    Ideal</span>
                                <strong style="font-size:1rem; color:#3498db;" id="valIdealWeight">-- kg</strong>
                            </div>
                            <div
                                style="background:rgba(231, 76, 60, 0.05); padding:8px; border-radius:8px; border:1px solid rgba(231, 76, 60, 0.1);">
                                <span
                                    style="font-size:0.6rem; color:#888; display:block; text-transform:uppercase; letter-spacing:0.5px;">IPT
                                    (% Peso Ideal)</span>
                                <strong style="font-size:1rem; color:#e74c3c;" id="valIPT">-- %</strong>
                                <div id="valIPTClass"
                                    style="font-size:0.65rem; color:#c0392b; margin-top:2px; font-weight:600;"></div>
                            </div>
                        </div>

                        <div class="grid-col-4" style="margin-top:10px;">
                            <!-- Restored Actividad Field (Fix TypeError) -->
                            <div class="mini-input">
                                <label>Actividad</label>
                                <select id="actividad">
                                    <option value="1.2">Encamado (1.2)</option>
                                    <option value="1.3">Ligera (1.3)</option>
                                    <option value="1.5">Moderada (1.5)</option>
                                    <option value="1.7">Intensa (1.7)</option>
                                </select>
                            </div>
                        </div>
                        <!-- New Calculator Section: TMB & Factorial -->
                        <div style="margin-top:10px; padding:10px; background:#f8fafc; border-radius:8px;">
                            <label
                                style="font-size:0.75rem; font-weight:700; color:#555; display:block; margin-bottom:5px;">Est.
                                Requerimientos</label>

                            <div style="display:flex; gap:5px; align-items:center; margin-bottom:8px;">
                                <select id="tmbMethod"
                                    style="flex:1; padding:4px; font-size:0.75rem; border-radius:6px; border:1px solid #ddd;"
                                    onchange="calcTMB_OMS()">
                                    <option value="oms">OMS / FAO / UNU</option>
                                    <option value="hb">Harris-Benedict</option>
                                    <option value="schofield">Schofield</option>
                                    <option value="msj">Mifflin-St Jeor</option>
                                </select>
                                <div class="result-badge" id="resTMB">-- kcal</div>
                            </div>

                            <!-- Row 2: Factorial -->
                            <div style="display:flex; gap:5px; align-items:center;">
                                <div class="mini-input" style="flex:1;">
                                    <label>M√©todo Factorial (kcal/kg)</label>
                                    <input type="number" id="factorKcal" placeholder="25-30" value="25">
                                </div>
                                <div class="result-badge" id="resFactorial">-- kcal</div>
                            </div>

                            <!-- NEW V3.15: Visual GET Box -->
                            <div id="getContainer"
                                style="margin-top:12px; padding:12px; background:rgba(108, 92, 231, 0.1); border:1px solid rgba(108, 92, 231, 0.2); border-radius:10px; text-align:center;">
                                <span
                                    style="font-size:0.65rem; color:#6c5ce7; font-weight:700; text-transform:uppercase; letter-spacing:1px;">Gasto
                                    Energ√©tico Total (GET)</span>
                                <div id="valGET"
                                    style="font-size:1.6rem; font-weight:800; color:#6c5ce7; line-height:1.2;">0 kcal
                                </div>
                                <small style="font-size:0.6rem; color:#888;">TMB √ó Factor Actividad</small>
                            </div>
                        </div>

                        <!-- Goal & Evolution Inputs -->
                        <div style="margin-top: 15px; padding-top:15px; border-top:1px dashed #ddd;">
                            <label
                                style="font-size:0.75rem; font-weight:700; color:#666; margin-bottom:5px; display:block;">Metas
                                y Evoluci√≥n</label>
                            <div class="grid-col-2">
                                <div class="mini-input">
                                    <label>Evoluci√≥n (kcal/kg)</label>
                                    <input type="number" id="goalKcalBox" placeholder="Actual (Ej. 20)">
                                    <!-- Result Badge BELOW the input -->
                                    <div id="evolutionResult"
                                        style="font-size:0.75rem; color:var(--primary); font-weight:700; margin-top:2px;">
                                        0 kcal/d√≠a</div>
                                </div>
                                <div class="mini-input">
                                    <label>Meta Total (kcal/d√≠a)</label>
                                    <input type="number" id="goalTotal" placeholder="Objetivo Final">
                                    <div id="valLastGoalDate"
                                        style="font-size:0.6rem; color:#888; margin-top:2px; font-style:italic;">
                                        Ultima meta: --
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="input-row-multi" style="margin-top:15px;">
                            <button type="submit" class="btn-save-small" style="width:100%;">Guardar Paciente</button>
                        </div>
                    </form>
                </section>

                <!-- NEW: Hydration Card -->
                <section class="card hydration-card" style="border-left: 5px solid #3498db;">
                    <div class="card-header" style="margin-bottom:10px;">
                        <h3>üíß Balance H√≠drico</h3>
                        <div style="display:flex; gap:10px; font-size:0.8rem;">
                            <label style="cursor:pointer; display:flex; align-items:center; gap:4px;">
                                <input type="radio" name="hydMethod" value="holiday" checked
                                    onchange="toggleHydMethod()">
                                Holiday
                            </label>
                            <label style="cursor:pointer; display:flex; align-items:center; gap:4px;">
                                <input type="radio" name="hydMethod" value="mlkg" onchange="toggleHydMethod()"> ml/kg
                            </label>
                        </div>
                    </div>

                    <!-- Input Factor ml/kg (Hidden by default) -->
                    <div id="hydFactorRow" style="display:none; margin-bottom:15px; text-align:right;">
                        <label style="font-size:0.8rem; margin-right:5px;">Factor:</label>
                        <input type="number" id="hydFactor" value="30"
                            style="width:50px; padding:4px; border-radius:6px; border:1px solid #ddd; text-align:center;">
                        <span style="font-size:0.8rem;">ml/kg</span>
                    </div>

                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <div style="text-align:center;">
                            <span style="font-size:0.7rem; color:#888;">Requerimiento</span>
                            <div style="font-size:1.4rem; font-weight:700; color:#3498db;"><span id="hydReq">0</span> ml
                            </div>
                        </div>
                        <div style="font-size:1.5rem; opacity:0.2;">‚ûî</div>
                        <div style="text-align:center;">
                            <span style="font-size:0.7rem; color:#888;">D√©ficit (Agua Libre)</span>
                            <div style="font-size:1.4rem; font-weight:700; color:#e74c3c;" id="hydDeficitBox"><span
                                    id="hydDeficit">0</span> ml</div>
                        </div>
                    </div>

                    <!-- NEW V3.12: Clinical Hydration Row -->
                    <div
                        style="display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap:10px; margin-top:10px; border-top:1px solid rgba(0,0,0,0.05); padding-top:10px; text-align:center;">
                        <div>
                            <span style="font-size:0.6rem; color:#888; display:block;">Ingreso Actual</span>
                            <strong style="font-size:0.85rem;" id="valHydTotal">0 ml</strong>
                        </div>
                        <div>
                            <span style="font-size:0.6rem; color:#888; display:block;">Relaci√≥n ml/kcal</span>
                            <strong style="font-size:0.85rem;" id="valHydRatio">0.0</strong>
                        </div>
                        <div>
                            <span style="font-size:0.6rem; color:#888; display:block;">Balance Est.</span>
                            <strong style="font-size:0.85rem;" id="valHydBalance">0 ml</strong>
                        </div>
                    </div>

                    <div class="water-bar-container" style="margin-top:15px;">
                        <div class="water-bar" id="hydBar"></div>
                    </div>
                    <small
                        style="text-align:center; display:block; margin-top:5px; opacity:0.6; font-size:0.7rem;">Basado
                        en Peso Actual</small>
                </section>


                <!-- SECCI√ìN 2: SIMULADOR INTEGRADO -->
                <section class="card simulator-card">
                    <div class="sim-header-dashboard">
                        <div class="mode-selector">
                            <button class="mode-toggle active" data-mode="vol">Vol / Dil</button>
                            <button class="mode-toggle" data-mode="grams">Gramaje</button>
                        </div>
                        <button id="btnToggleCompare" class="btn-micro" style="margin-left:auto; font-weight:700;">üÜö
                            Comparar</button>


                        <div class="progress-container-mini">
                            <div class="prog-label">Meta: <span id="simGoal">--</span> kcal</div>
                            <div class="prog-track">
                                <div class="prog-fill" id="simBar"></div>
                            </div>
                            <div class="prog-label">Cons: <span id="simCurrent">0</span> kcal</div>
                        </div>
                    </div>

                    <!-- NEW: Infusion Calculator -->
                    <div class="infusion-box">
                        <div class="infusion-title">
                            <span>‚è±Ô∏è Calculadora de Infusi√≥n</span>
                            <small style="opacity:0.5; font-weight:400;">(Opcional)</small>
                        </div>
                        <div class="grid-col-2">
                            <div class="mini-input">
                                <label>Velocidad (ml/hr)</label>
                                <input type="number" id="infusionRate" placeholder="Ej. 60">
                            </div>
                            <div class="mini-input">
                                <label>Hora Inicio</label>
                                <input type="time" id="infusionStart">
                            </div>
                        </div>
                        <div class="infusion-result" id="infusionResultBox" style="display:none;">
                            Termina a las: <strong id="valEndTime">--:--</strong> <span id="valDuration"
                                style="font-size:0.75rem; opacity:0.7;">(0 hrs)</span>
                        </div>
                    </div>

                    <div class="sim-inputs">
                        <div class="input-group">
                            <label>F√≥rmula / Leche HRA / RTH</label>

                            <div style="margin-bottom:8px;">
                                <input type="text" id="formulaSearch" placeholder="üîç Buscar f√≥rmula..."
                                    style="width:100%; padding:6px 10px; font-size:0.8rem; border-radius:8px; border:1px solid #ddd; outline:none; background:rgba(255,255,255,0.8);">
                            </div>
                            <div style="display:flex; gap:10px; align-items:center;">
                                <select id="formulaSelect" class="select-modern"></select>
                                <button id="btnToggleFav" class="btn-micro" style="font-size:1.2rem; padding: 5px 10px;"
                                    title="Marcar como Favorita">‚òÜ</button>
                            </div>
                        </div>

                        <!-- NEW: Compare Formula Selector (Hidden) -->
                        <div class="input-group" id="compareRow"
                            style="display:none; margin-top:10px; border-top:1px dashed #ddd; padding-top:10px;">
                            <label style="color:var(--secondary); font-weight:700;">üÜö Comparar con:</label>

                            <select id="formulaSelectB" class="select-modern"></select>

                            <div id="compareResult"
                                style="margin-top:10px; font-size:0.9rem; font-weight:800; display:flex; gap:10px; align-items:center; justify-content: flex-end; color:var(--primary);">
                                <!-- JS will populate with Vs: badge -->
                            </div>
                        </div>

                        <div class="grid-col-2">
                            <div class="input-group">
                                <label>Volumen (ml)</label>
                                <input type="number" id="volume" placeholder="ml">
                            </div>
                            <div class="input-group">
                                <label id="lblDilution">Diluci√≥n (%)</label>
                                <input type="number" id="dilution" placeholder="%">
                            </div>
                        </div>
                    </div>
                </section>

                <!-- NEW V3.50: CALCULADORA DE M√ìDULOS -->
                <section class="card simulator-card" style="margin-top: -15px;">
                    <details class="folds-accordion" id="modulesAccordion">
                        <summary style="font-weight:700; color:var(--primary);">‚ûï Calculadora de M√≥dulos (Refuerzos)
                        </summary>
                        <div class="modules-grid"
                            style="display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:10px; padding-top:10px;">
                            <div class="mini-input">
                                <label>Nessucar (g)</label>
                                <input type="number" id="modNessucar" class="input-module" placeholder="g">
                            </div>
                            <div class="mini-input">
                                <label>MCT Oil (ml)</label>
                                <input type="number" id="modMCT" class="input-module" placeholder="ml">
                            </div>
                            <div class="mini-input">
                                <label>Enterex Karb (g)</label>
                                <input type="number" id="modEnterex" class="input-module" placeholder="g">
                            </div>
                            <div class="mini-input">
                                <label>Banatrol Plus (g)</label>
                                <input type="number" id="modBanatrol" class="input-module" placeholder="g">
                            </div>
                            <div class="mini-input">
                                <label>Proteinex (g)</label>
                                <input type="number" id="modProteinex" class="input-module" placeholder="g">
                            </div>
                            <div class="mini-input">
                                <label>Fresubin Powder (g)</label>
                                <input type="number" id="modFresubin" class="input-module" placeholder="g">
                            </div>
                        </div>
                        <small style="display:block; margin-top:8px; opacity:0.6; font-size:0.65rem;">Los m√≥dulos se
                            suman al aporte total de la f√≥rmula seleccionada.</small>
                    </details>
                </section>

                <!-- NEW V3.60: INGESTA ORAL Y SUEROTERAPIA -->
                <section class="card simulator-card" style="margin-top: -15px;">
                    <details class="folds-accordion" id="oralIvAccordion">
                        <summary style="font-weight:700; color:var(--primary);">üè• Ingesta Oral y Sueroterapia</summary>

                        <!-- Sueroterapia (IV Fluids) -->
                        <h4
                            style="font-size: 0.8rem; color: #555; margin-top: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px;">
                            üíß Sueroterapia (Fluidos IV)</h4>
                        <div class="modules-grid"
                            style="display:grid; grid-template-columns: minmax(0, 1fr) minmax(0, 1fr); gap:10px; padding-top:10px;">
                            <div class="mini-input">
                                <label>Tipo de Suero</label>
                                <select id="ivType"
                                    style="padding:8px; border-radius:8px; border:1px solid rgba(0,0,0,0.1); width:100%; font-size:0.85rem;">
                                    <option value="none">Ninguno</option>
                                    <option value="sg5">Suero Glucosado 5%</option>
                                    <option value="sg10">Suero Glucosado 10%</option>
                                    <option value="sf">Suero Fisiol√≥gico 0.9%</option>
                                    <option value="ringer">Ringer Lactato</option>
                                </select>
                            </div>
                            <div class="mini-input">
                                <label>Volumen Total (ml/d√≠a)</label>
                                <input type="number" id="ivVolume" class="input-iv" placeholder="ml">
                            </div>
                        </div>

                        <!-- Ingesta Oral -->
                        <h4
                            style="font-size: 0.8rem; color: #555; margin-top: 20px; border-bottom: 1px solid #eee; padding-bottom: 5px;">
                            üç≤ Ingesta Oral / Bandeja</h4>
                        <div class="modules-grid"
                            style="display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:10px; padding-top:10px;">
                            <div class="mini-input">
                                <label>Energ√≠a (kcal)</label>
                                <input type="number" id="oralKcal" class="input-oral" placeholder="kcal">
                            </div>
                            <div class="mini-input">
                                <label>Prote√≠nas (g)</label>
                                <input type="number" id="oralProt" class="input-oral" placeholder="g">
                            </div>
                            <div class="mini-input">
                                <label>H. de Carbono (g)</label>
                                <input type="number" id="oralCHO" class="input-oral" placeholder="g">
                            </div>
                            <div class="mini-input">
                                <label>L√≠pidos (g)</label>
                                <input type="number" id="oralLip" class="input-oral" placeholder="g">
                            </div>
                            <div class="mini-input">
                                <label>Agua / L√≠quidos (ml)</label>
                                <input type="number" id="oralWater" class="input-oral" placeholder="ml">
                            </div>
                        </div>
                        <small style="display:block; margin-top:10px; opacity:0.6; font-size:0.65rem;">El suero y la v√≠a
                            oral se suman autom√°ticamente al total de aportes contra los requerimientos.</small>
                    </details>
                </section>
            </main>

            <div class="macro-stack-wrapper">
                <!-- Primary Bar -->
                <div class="macro-stack-bar" id="stackPrimary">
                    <div class="stack-segment p" id="barProt" style="width:0%"></div>
                    <div class="stack-segment c" id="barCHO" style="width:0%"></div>
                    <div class="stack-segment f" id="barLip" style="width:0%"></div>
                </div>
                <!-- Secondary Bar (Comparison) -->
                <div class="macro-stack-bar secondary" id="stackCompare"
                    style="display:none; opacity:0; transform:translateY(18px);">
                    <div class="stack-segment p" id="barProtB" style="width:0%"></div>
                    <div class="stack-segment c" id="barCHOB" style="width:0%"></div>
                    <div class="stack-segment f" id="barLipB" style="width:0%"></div>
                </div>
            </div>

            <!-- Formula B Macro Board (Shown only in Compare Mode) -->
            <div id="macroBoardB" class="macro-board"
                style="display:none; margin-top:20px; background:rgba(142, 68, 173, 0.05); padding:15px; border-radius:20px; border:1px solid rgba(142, 68, 173, 0.1);">
                <div id="lblFormulaB"
                    style="grid-column: 1 / -1; font-size: 0.75rem; font-weight: 700; color: var(--primary); margin-bottom: 5px; text-align: center;">
                    F√≥rmula B</div>
                <div class="macro-item k"><label>Energ√≠a</label><span id="valKcalB"
                        style="font-size:1.1rem;">0</span><small>kcal</small></div>
                <div class="macro-item p"><label>Prote√≠na</label><span id="valProtB"
                        style="font-size:1.1rem;">0</span><small>g</small></div>
                <div class="macro-item c"><label>H. Carbono</label><span id="valCHOB"
                        style="font-size:1.1rem;">0</span><small>g</small></div>
                <div class="macro-item f"><label>L√≠pidos</label><span id="valLipB"
                        style="font-size:1.1rem;">0</span><small>g</small></div>
            </div>

            <!-- Donut Chart + Macros -->
            <div
                style="display:flex; gap:15px; align-items:center; margin-top:20px; justify-content:center; flex-wrap:wrap;">
                <div style="width:80px; height:80px; position:relative;">
                    <canvas id="macroChart"></canvas>
                </div>
                <div class="macro-board" style="flex:1; margin:0; max-width:400px;">
                    <div class="macro-item k"><label>Energ√≠a</label><span id="valKcal">0</span><small>kcal</small></div>
                    <div class="macro-item p"><label>Prot</label><span id="valProt">0</span><small>g</small></div>
                    <div class="macro-item c"><label>CHO</label><span id="valCHO">0</span><small>g</small></div>
                    <div class="macro-item f"><label>L√≠p</label><span id="valLip">0</span><small>g</small></div>
                </div>
            </div>

            <!-- Prescribir button removed in V3.43 as requested (non-functional) -->
        </div><!-- End View Dashboard -->

        <!-- VISTA EVALUACI√ìN COMPLETA (NUEVO) -->
        <div id="view-assessment" class="view-section" style="display:none;">
            <div class="view-header">
                <h2>Evaluaci√≥n Nutricional Completa</h2>
            </div>

            <div class="assess-grid">
                <!-- 1. Antropometr√≠a Avanzada -->
                <section class="card assess-module">
                    <div class="module-head">
                        <h3>üìè Antropometr√≠a Avanzada</h3>
                    </div>
                    <div class="grid-col-3">
                        <div class="mini-input">
                            <label>C. Cintura (cm)</label>
                            <input type="number" id="ccintura">
                        </div>
                        <div class="mini-input">
                            <label>C. Braquial (cm)</label>
                            <input type="number" id="cbraquial" class="input-watch" placeholder="cm">
                            <div class="interp-badge" id="valCBClass" style="margin-top:5px; min-height:1.5rem;">--
                            </div>
                        </div>
                        <div class="mini-input">
                            <label>C. Pantorrilla (cm)</label>
                            <input type="number" id="cpantorrilla">
                        </div>
                    </div>


                    <!-- Frisancho/NHANES Red Box -->
                    <div class="ross-box-featured" id="frisanchoContainer"
                        style="margin-bottom:20px; display:none; background:rgba(192, 57, 43, 0.05); padding:15px; border-radius:12px; border:1px solid rgba(192, 57, 43, 0.2);">
                        <div
                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <h5 style="color:#c0392b; margin:0; font-size:0.8rem;">üìä Clasificaci√≥n Frisancho / NHANES
                            </h5>
                            <div id="valAnthDate" style="font-size:0.6rem; color:#888; font-style:italic;">√öltima act:
                                --</div>
                        </div>

                        <div class="anth-grid"
                            style="display:grid; grid-template-columns: minmax(0, 1fr) minmax(0, 1fr); gap:10px; margin-bottom:12px;">
                            <div style="border-right: 1px solid rgba(192,57,43,0.1); padding-right:10px;">
                                <label
                                    style="font-size:0.6rem; color:#666; text-transform:uppercase; display:block; margin-bottom:2px;">Circ.
                                    Braquial (CB)</label>
                                <div id="lblCBStatus"
                                    style="font-weight:700; color:#c0392b; font-size:0.85rem; line-height:1.2;">--</div>
                            </div>
                            <div style="padding-left:10px;">
                                <label
                                    style="font-size:0.6rem; color:#666; text-transform:uppercase; display:block; margin-bottom:2px;">√Årea
                                    Muscular (AG)</label>
                                <div id="lblAGStatus"
                                    style="font-weight:700; color:#c0392b; font-size:0.85rem; line-height:1.2;">--</div>
                            </div>
                        </div>

                        <!-- Graphical Scale -->
                        <div class="anth-scale-wrapper"
                            style="margin-top:10px; border-top:1px solid rgba(192,57,43,0.1); padding-top:10px;">
                            <div
                                style="display:flex; justify-content:space-between; font-size:0.55rem; color:#888; margin-bottom:4px;">
                                <span>Muy Bajo (p5)</span>
                                <span>Normal</span>
                                <span>Muy Alto (p95)</span>
                            </div>
                            <div class="anth-scale-bar"
                                style="height:10px; background:#e0e0e0; border-radius:5px; position:relative; overflow:hidden; border:1px solid rgba(0,0,0,0.05);">
                                <!-- Background zones -->
                                <div style="position:absolute; left:0; width:5%; height:100%; background:rgba(192,57,43,0.4);"
                                    title="< p5"></div>
                                <div style="position:absolute; left:5%; width:5%; height:100%; background:rgba(192,57,43,0.2);"
                                    title="p5 - p10"></div>
                                <div style="position:absolute; left:10%; width:80%; height:100%; background:rgba(39,174,96,0.1);"
                                    title="Normal"></div>
                                <div style="position:absolute; left:90%; width:5%; height:100%; background:rgba(192,57,43,0.2);"
                                    title="p90 - p95"></div>
                                <div style="position:absolute; left:95%; width:5%; height:100%; background:rgba(192,57,43,0.4);"
                                    title="> p95"></div>

                                <!-- Indicator Dot -->
                                <div id="anthIndicator"
                                    style="position:absolute; top:0; left:50%; width:6px; height:100%; background:#c0392b; box-shadow:0 0 5px rgba(0,0,0,0.3); transition:left 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index:2; border-radius:3px; transform: translateX(-50%);">
                                </div>
                            </div>
                        </div>
                    </div>

                    <details class="folds-accordion">
                        <summary>Agregar otros par√°metros (Pliegues y Per√≠metros)</summary>
                        <div class="folds-grid">
                            <h5>Pliegues Cut√°neos</h5>
                            <div class="grid-col-4">
                                <div class="mini-input"><label>Tricipital (PT mm)</label><input type="number"
                                        id="ptricipital" class="input-watch" placeholder="mm">
                                    <div class="interp-badge" id="valAGClass"
                                        style="margin-top:5px; min-height:1.5rem;">--</div>
                                </div>
                                <div class="mini-input"><label>Bicipital</label><input type="number" id="pbicipital">
                                </div>
                                <div class="mini-input"><label>Suprail√≠aco</label><input type="number" id="piliaco">
                                </div>
                                <div class="mini-input"><label>Abdominal</label><input type="number" id="pabdominal">
                                </div>
                            </div>
                            <h5 style="margin-top:10px;">Talla/Otros</h5>
                            <div class="grid-col-3">
                                <div class="mini-input"><label>Media Env.</label><input type="number" id="mediaenv">
                                </div>
                                <div class="mini-input"><label>Env. Completa</label><input type="number" id="envcomp">
                                </div>
                                <div class="mini-input">
                                    <label>Altura rodilla ATR (cm)</label>
                                    <input type="number" id="altrodilla" class="input-watch-chumlea" placeholder="cm">
                                    <div id="estContainerStacked"
                                        style="display:none; margin-top:8px; flex-direction:column; gap:5px;">
                                        <div id="valRossStatureBadge"
                                            style="background:rgba(155, 89, 182, 0.1); color:#8e44ad; padding:5px; border-radius:10px; font-size:0.7rem; font-weight:700; border:1px solid rgba(155, 89, 182, 0.2); text-align:center;">
                                            Talla Ross: --
                                        </div>
                                        <div id="valChumleaWeightBadge"
                                            style="background:rgba(39, 174, 96, 0.1); color:#27ae60; padding:5px; border-radius:10px; font-size:0.7rem; font-weight:700; border:1px solid rgba(39, 174, 96, 0.2); text-align:center;">
                                            Peso Chumlea: --
                                        </div>
                                        <input type="hidden" id="valChumleaWeight">
                                        <input type="hidden" id="valRossStature">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </details>
                </section>

                <!-- 2. Examen F√≠sico (Edema) -->
                <section class="card assess-module">
                    <div class="module-head">
                        <h3>ü©∫ Examen F√≠sico</h3>
                    </div>
                    <div class="input-group">
                        <label>Grado de Edema</label>
                        <select id="edemaGrade" class="select-modern">
                            <option value="0">Ausente</option>
                            <option value="1">Grado + (1kg)</option>
                            <option value="3">Grado ++ (3kg)</option>
                            <option value="7">Grado +++ (7kg)</option>
                            <option value="10">Grado ++++ (10kg Anasarca)</option>
                        </select>
                    </div>
                    <div class="dry-weight-box">
                        Peso Seco Estimado: <strong id="valDryWeight">--</strong> kg
                    </div>
                </section>

                <!-- 3. Ex√°menes Bioqu√≠micos -->
                <section class="card assess-module">
                    <div class="module-head">
                        <h3>ü©∏ Ex√°menes Bioqu√≠micos</h3>
                        <button class="btn-micro" id="btnAddExam">+</button>
                    </div>
                    <div class="exams-list" id="examsContainer">
                        <!-- Dynamic Rows -->
                    </div>
                </section>

                <!-- NEW V3.50: INTERACCIONES F√ÅRMACO-NUTRIENTE -->
                <section class="card assess-module" style="border-left-color: #e74c3c;">
                    <div class="module-head">
                        <h3>üíä Interacciones F√°rmaco-Nutriente</h3>
                    </div>
                    <div class="input-group">
                        <input type="text" id="drugSearch" placeholder="üîç Buscar f√°rmaco (ej. Fenitoina, Propofol...)"
                            style="width:100%; padding:10px; border-radius:10px; border:1px solid #ddd; font-size:0.85rem;">
                    </div>
                    <div id="drugInteractionResult"
                        style="margin-top:10px; font-size:0.8rem; line-height:1.4; min-height:40px;">
                        <span style="opacity:0.5;">Busca un medicamento para ver recomendaciones nutricionales
                            hospitalarias.</span>
                    </div>
                </section>

                <!-- 4. Balance Nitrogenado -->
                <section class="card assess-module">
                    <div class="module-head">
                        <h3>‚öñÔ∏è Balance Nitrogenado</h3>
                    </div>
                    <div class="grid-col-2">
                        <div class="mini-input">
                            <label>NUU (g/24h)</label>
                            <input type="number" id="valNUU" placeholder="Urea Urinaria">
                        </div>
                        <div class="mini-input">
                            <label>Factor P√©rdidas</label>
                            <input type="number" id="valNFactor" value="4" placeholder="4">
                        </div>
                    </div>
                    <small style="font-size:0.7rem; color:#666; display:block; margin-bottom:10px;">
                        BN = (Prot/6.25) - (NUU + Factor)
                    </small>
                    <div class="bn-result" id="bnResult">
                        Resultado: --
                    </div>
                </section>

                <!-- 5. Cribaje de Riesgo -->
                <section class="card assess-module" style="border-left-color: #f1c40f;">
                    <div class="module-head">
                        <h3>üìã Cribaje de Riesgo</h3>
                    </div>
                    <div class="grid-col-2">
                        <div class="mini-input">
                            <label>Riesgo NRS-2002</label>
                            <select id="nrs2002" class="select-modern">
                                <option value="bajo">Bajo (0-2 pts)</option>
                                <option value="alto">Alto (‚â• 3 pts)</option>
                                <option value="riesgo">Paciente de Riesgo</option>
                                <option value="sin_riesgo">Sin Riesgo Cr√≠tico</option>
                            </select>
                        </div>
                        <div class="mini-input">
                            <label>VGS (Valoraci√≥n Global)</label>
                            <select id="vgs" class="select-modern">
                                <option value="A">A (Bien nutrido)</option>
                                <option value="B">B (Desnutrici√≥n Moderada)</option>
                                <option value="C">C (Desnutrici√≥n Severa)</option>
                            </select>
                        </div>
                    </div>
                </section>

                <!-- 6. Tolerancia Gastrointestinal -->
                <section class="card assess-module" style="border-left-color: #1abc9c;">
                    <div class="module-head">
                        <h3>ü¶† Tolerancia GI</h3>
                    </div>
                    <div class="grid-col-3">
                        <div class="mini-input">
                            <label>Residuo G√°strico</label>
                            <select id="residuo" class="select-modern">
                                <option value="no">Ausente</option>
                                <option value="si">Presente</option>
                            </select>
                        </div>
                        <div class="mini-input">
                            <label>Diarrea / Deposic.</label>
                            <select id="diarrea" class="select-modern">
                                <option value="no">Normal</option>
                                <option value="si">Diarrea/Alt.</option>
                            </select>
                        </div>
                        <div class="mini-input">
                            <label>Distensi√≥n Abd.</label>
                            <select id="distension" class="select-modern">
                                <option value="no">No</option>
                                <option value="si">S√≠</option>
                            </select>
                        </div>
                    </div>
                </section>

                <!-- 7. V√≠as de Acceso -->
                <section class="card assess-module" style="border-left-color: #e67e22;">
                    <div class="module-head">
                        <h3>üìç V√≠as de Acceso</h3>
                    </div>
                    <div class="grid-col-2">
                        <div class="mini-input">
                            <label>Tipo de Acceso</label>
                            <select id="accesoTipo" class="select-modern">
                                <option value="oral">V√≠a Oral</option>
                                <option value="sng">SNG (Nasog√°strica)</option>
                                <option value="snj">SNJ (Nasoyeyunal)</option>
                                <option value="gtt">GTT (Gastrostom√≠a)</option>
                                <option value="yeyuno">Yeyunostom√≠a</option>
                            </select>
                        </div>
                        <div class="mini-input">
                            <label>Fecha Instalaci√≥n</label>
                            <input type="date" id="accesoFecha">
                        </div>
                    </div>
                </section>

                <!-- 8. Diagn√≥stico Nutricional -->
                <section class="card assess-module" style="border-left-color: #9b59b6;">
                    <div class="module-head">
                        <h3>üìë Diagn√≥stico Nutricional Integrado</h3>
                    </div>
                    <div class="input-group">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <label style="margin-bottom: 0;">Evoluci√≥n / PES / Diagn√≥stico</label>
                            <button id="btnMicPES" class="btn-micro"
                                style="background: transparent; border: 1px solid var(--primary); color: var(--primary); display: flex; align-items: center; gap: 5px;"
                                title="Dictado por Voz">
                                üéôÔ∏è <span id="micStatus">Dictar</span>
                            </button>
                        </div>
                        <textarea id="diagnosticoPES" rows="4"
                            style="width:100%; border-radius:10px; border:1px solid #ddd; padding:10px; font-size:0.85rem;"
                            placeholder="Escriba el diagn√≥stico integrado aqu√≠ (o use el micr√≥fono)..."></textarea>
                    </div>
                </section>
            </div>

            <!-- NEW V3.50: GENERADOR DE NOTA CL√çNICA -->
            <div style="margin: 25px 15px;">
                <button class="btn-ia-generate" id="btnGenerateNote"
                    style="background: linear-gradient(135deg, #8e44ad, #9b59b6); margin-bottom: 15px;">
                    ‚ú® Generar Nota Cl√≠nica (Copy)
                </button>

                <div id="clinicalNoteContainer" class="card"
                    style="display:none; padding:20px; border: 1px solid var(--primary); background: white;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h4 style="margin:0; color:var(--primary);">üìã Resumen de Evoluci√≥n</h4>
                        <button class="btn-micro" id="btnCopyNote">Copiar Texto</button>
                    </div>
                    <div id="noteContent" style="font-size:0.85rem; line-height:1.5; color:#333;">
                        <!-- Generated Content -->
                    </div>
                </div>
            </div>
        </div>

        <!-- VISTA NUTRI IA (ü¶¶ NUEVO V3.23) -->
        <div id="view-nutri-ia" class="view-section" style="display:none;">
            <div class="view-header">
                <h2>ü¶¶ Nutri IA - An√°lisis Cl√≠nico Inteligente</h2>
            </div>

            <div class="ia-welcome-card" id="iaInitialState">
                <div class="ia-icon-large">ü¶¶</div>
                <h3>¬°Hola! Soy tu asistente de Nutrici√≥n IA</h3>
                <p>Analizar√© toda la informaci√≥n recolectada del paciente para sugerir un plan basado en los protocolos
                    del <b>Hospital Regional de Antofagasta</b>.</p>
                <div style="margin: 20px 0;">
                    <button class="btn-ia-generate" id="btnGenerateIA">
                        <span id="iaBtnLabel">üöÄ Generar An√°lisis Completo</span>
                        <div class="spinner-ia" id="iaSpinner" style="display:none;"></div>
                    </button>
                </div>
                <small style="opacity:0.6; font-size:0.7rem;">Requiere conexi√≥n a internet y configuraci√≥n de API
                    Gemini.</small>
            </div>

            <div id="iaResultContainer" class="ia-report-view" style="display:none;">
                <!-- Generated Report will appear here -->
            </div>
        </div>
        <div id="pwaInstallContainer" style="display:none; text-align:center; margin-top:15px;">
            <span id="btnInstallApp"
                style="cursor:pointer; font-size:0.75rem; color:var(--primary); text-decoration:underline;">
                Dejar aplicaci√≥n en pantalla de inicio üì±
            </span>
        </div> <!-- End Main App -->

        <!-- VISTA KANBAN DE SALA (NEW V3.60) -->
        <div id="view-ward" class="view-section">
            <div class="card" style="margin-bottom: 20px;">
                <div class="card-header" style="display:flex; justify-content:space-between; align-items:center;">
                    <h2>üè• Gesti√≥n de Sala (Pacientes Activos)</h2>
                    <div style="display:flex; gap:10px;">
                        <button id="btnPrintHandoff" class="btn-micro" style="background:#27ae60; color:white;">üñ®Ô∏è
                            Imprimir Entrega</button>
                        <button id="btnRefreshWard" class="btn-micro" style="background:var(--primary); color:white;">üîÑ
                            Actualizar</button>
                    </div>
                </div>
                <!-- Kanban Board -->
                <div class="kanban-board"
                    style="display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 15px; margin-top: 15px;">
                    <!-- Columna: Activos / Prioritarios -->
                    <div class="kanban-column"
                        style="background:#f8f9fa; border-radius:15px; padding:15px; border-top: 4px solid #3498db;">
                        <h3 style="font-size:0.95rem; margin-bottom:15px; display:flex; justify-content:space-between;">
                            En Curso <span id="countActivos"
                                style="background:#eee; padding:2px 8px; border-radius:12px; font-size:0.8rem;">0</span>
                        </h3>
                        <div id="colActivos" class="kanban-list"
                            style="display:flex; flex-direction:column; gap:10px; min-height:200px;">
                            <!-- Cards inserted here by JS -->
                        </div>
                    </div>

                    <!-- Columna: Observaci√≥n / Cr√≠ticos -->
                    <div class="kanban-column"
                        style="background:#f8f9fa; border-radius:15px; padding:15px; border-top: 4px solid #e74c3c;">
                        <h3 style="font-size:0.95rem; margin-bottom:15px; display:flex; justify-content:space-between;">
                            Cr√≠ticos / Alertas <span id="countCriticos"
                                style="background:#eee; padding:2px 8px; border-radius:12px; font-size:0.8rem;">0</span>
                        </h3>
                        <div id="colCriticos" class="kanban-list"
                            style="display:flex; flex-direction:column; gap:10px; min-height:200px;">
                            <!-- Cards inserted here by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL DE HISTORIAL -->
        <div class="protocol-modal" id="historyModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Historial de Pacientes</h2>
                    <button class="btn-close" id="btnHistoryClose">&times;</button>
                </div>
                <div class="history-list" id="historyContainer">
                    <div id="chartContainer"
                        style="display:none; margin-bottom: 20px; padding: 10px; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                        <canvas id="evolutionChart" width="400" height="200"></canvas>
                        <p style="text-align:center; font-size:0.7rem; color:#888; margin-top:5px;">Evoluci√≥n de Peso
                            (√öltimos 5 registros)</p>
                    </div>
                    <div id="patientListContainer">
                        <p style="text-align:center; opacity:0.6;">Cargando tus registros...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW V3.60: MODAL QUICK VIEW (MEDICAL ROUND) -->
        <div class="protocol-modal" id="quickViewModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üìã Resumen de Bolsillo</h2>
                    <button class="btn-close" id="btnQuickViewClose">&times;</button>
                </div>
                <div id="quickViewContent" style="flex:1; overflow-y:auto; padding-right:10px; font-size:0.9rem;">
                    <!-- Content injected by JS -->
                </div>
            </div>
        </div>

        <!-- MODAL DE PROTOCOLOS (EXISTENTE) -->
        <div class="protocol-modal" id="protocolModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Protocolos Institucionales HRA</h2>
                    <button class="btn-close" id="btnProtocolClose">&times;</button>
                </div>
                <div class="tab-nav">
                    <button class="tab-btn active" onclick="switchProtocolTab(0)">Velocidades RTH</button>
                    <button class="tab-btn" onclick="switchProtocolTab(1)">Horarios de Entrega</button>
                </div>
                <div class="tab-content" id="tab-infusion" style="display:block;">
                    <h3 class="table-title">Enterales en ml y su duraci√≥n</h3>
                    <div class="table-scroll">
                        <table class="pretty-table">
                            <thead>
                                <tr>
                                    <th>500 ml</th>
                                    <th>1000 ml</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Row 1 -->
                                <tr>
                                    <td>20 ml/h = <strong>24 hrs</strong></td>
                                    <td>40 ml/h = <strong>24 hrs</strong></td>
                                </tr>
                                <!-- Row 2 -->
                                <tr>
                                    <td>25 ml/h = <strong>20 hrs</strong></td>
                                    <td>50 ml/h = <strong>20 hrs</strong></td>
                                </tr>
                                <!-- Row 3 -->
                                <tr>
                                    <td>30 ml/h = <strong>16 hrs</strong></td>
                                    <td>60 ml/h = <strong>16 hrs</strong></td>
                                </tr>
                                <!-- Row 4 -->
                                <tr>
                                    <td>40 ml/h = <strong>12 hrs</strong></td>
                                    <td>75 ml/h = <strong>13 hrs</strong></td>
                                </tr>
                                <!-- Row 5 -->
                                <tr>
                                    <td>50 ml/h = <strong>10 hrs</strong></td>
                                    <td>80 ml/h = <strong>12 hrs</strong></td>
                                </tr>
                                <!-- Row 6 -->
                                <tr>
                                    <td>60 ml/h = <strong>8 hrs</strong></td>
                                    <td>-</td>
                                </tr>
                                <!-- Row 7 -->
                                <tr>
                                    <td>75 ml/h = <strong>6 hrs</strong></td>
                                    <td>-</td>
                                </tr>
                                <!-- Row 8 -->
                                <tr>
                                    <td>80 ml/h = <strong>6 hrs</strong></td>
                                    <td>-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="tab-content" id="tab-delivery" style="display:none;">
                    <div class="table-scroll">
                        <table class="schedule-table">
                            <tr>
                                <td>Q3H</td>
                                <td>03-06-09-12-15-18-21-24</td>
                            </tr>
                            <tr>
                                <td>Q4H</td>
                                <td>06-10-14-18-22-02</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL PROP√ìSITO -->
        <div class="modal-overlay" id="purposeModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üìñ Prop√≥sito</h3>
                    <button class="btn-close-modal" id="btnPurposeClose">√ó</button>
                </div>
                <div class="modal-body" style="font-style: italic; color: #555; line-height: 1.6;">
                    <p>Esta plataforma fue creada con el fin de poder simplificar los tiempos para el nutricionista y
                        mejorar la calidad de los procesos evitando errores de c√°lculos por falta de tiempo o de
                        organizaci√≥n.</p>
                    <p style="margin-top:15px; font-weight:700; text-align:right;">Atte: Nut. Martin Gonzalez</p>
                </div>
            </div>
        </div>

        <script>
            // EMERGENCY CACHE PURGE V3.6
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(function (registrations) {
                    for (let registration of registrations) {
                        if (!localStorage.getItem('sw_purged_3.7')) {
                            registration.unregister();
                            localStorage.setItem('sw_purged_3.7', 'true');
                            window.location.reload();
                        }
                    }
                });
            }
        </script>
        <script src="config.js"></script>
        <script src="app_core.js?v=3.43"></script>

        <!-- NEW V3.60: PRINTABLE AREA FOR HANDOFF -->
        <div id="printHandoffArea"></div>
</body>

</html>