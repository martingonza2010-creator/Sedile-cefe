<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.jpg" type="image/jpeg">
    <title>SEDILE HRA | Professional Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="bg-blob blob-1"></div>
    <div class="bg-blob blob-2"></div>

    <!-- PANTALLA DE ACCESO (LOGIN) -->
    <section id="auth-screen" class="auth-container">
        <div class="login-card">
            <img src="https://i.imgur.com/ugEhxa1.jpeg" alt="Logo NutriMartin" class="logo-entrance">
            <h1>Bienvenido a SEDILE - HRA</h1>
            <p>Portal de Apoyo Nutricional Cl칤nico</p>
            <button id="btnLoginGoogle" class="btn-google" onclick="window.login()">
                <img src="https://cdn-icons-png.flaticon.com/512/2991/2991148.png" alt="G">
                Entrar con Google
            </button>
            <small>춸 2026 - Dr. Mart칤n Gonz치lez</small>
        </div>
    </section>

    <!-- APLICACI칍N PRINCIPAL (OCULTA HASTA LOGIN) -->
    <div id="main-app" class="app-container compact-mode" style="display:none;">

        <!-- Info Protocol Button -->
        <button class="protocol-fab" id="btnProtocolOpen" title="Protocolos Institucionales">
            <span>i</span> Protocolos HRA
        </button>

        <!-- Bot칩n Logout -->
        <button class="logout-btn" id="btnLogout" title="Cerrar Sesi칩n">Salir</button>

        <header class="main-header">
            <div class="brand-box">
                <img src="https://i.imgur.com/ugEhxa1.jpeg" alt="Logo" class="logo-small">
                <div>
                    <h1>SEDILE - HRA</h1>
                    <p id="userNameDisplay">Calculadora Cl칤nica</p>
                </div>
            </div>

            <div class="patient-quick-access" id="btnPatientToggle">
                <div class="p-avatar" id="currentPatientAvatar">P</div>
                <div class="p-info">
                    <span id="currentPatientName">Nuevo Paciente</span>
                    <small>IMC: <b id="valBMI">--</b> | Meta: <b id="valTMT">--</b> Kcal</small>
                </div>
            </div>
        </header>

        <main class="dashboard-grid">
            <!-- SECCI칍N 1: EVALUACI칍N -->
            <section class="card assessment-card">
                <div class="card-header">
                    <h3>Registro Evaluaci칩n</h3>
                    <div class="header-actions">
                        <button class="btn-micro" id="btnOpenHistory">游늭 Historial</button>
                        <button class="btn-micro" id="btnAddPatient">+ Nuevo</button>
                    </div>
                </div>
                <form id="form-paciente" class="compact-form">
                    <div class="input-row">
                        <input type="text" id="nombre" placeholder="Nombre completo" required>
                    </div>
                    <div class="grid-col-4">
                        <div class="mini-input">
                            <label>Edad</label>
                            <input type="number" id="edad" placeholder="0">
                        </div>
                        <div class="mini-input">
                            <label>Sexo</label>
                            <select id="sexo">
                                <option value="m">M</option>
                                <option value="f">F</option>
                            </select>
                        </div>
                        <div class="mini-input">
                            <label>Peso (kg)</label>
                            <input type="number" step="0.1" id="peso" placeholder="0">
                        </div>
                        <div class="mini-input">
                            <label>Talla (m)</label>
                            <input type="number" step="0.01" id="estatura" placeholder="0">
                        </div>
                    </div>
                    <div class="input-row-multi">
                        <select id="actividad" class="select-small">
                            <option value="1.2">AF: 1.2 (Reposo)</option>
                            <option value="1.3">AF: 1.3 (Ligero)</option>
                            <option value="1.5">AF: 1.5 (Mod)</option>
                        </select>
                        <button type="submit" class="btn-save-small">Guardar</button>
                    </div>
                </form>
            </section>

            <!-- SECCI칍N 2: SIMULADOR INTEGRADO -->
            <section class="card simulator-card">
                <div class="sim-header-dashboard">
                    <div class="mode-selector">
                        <button class="mode-toggle active" data-mode="vol">Vol / Dil</button>
                        <button class="mode-toggle" data-mode="grams">Gramaje</button>
                    </div>
                    <div class="progress-container-mini">
                        <div class="prog-label">Meta: <span id="simGoal">--</span> kcal</div>
                        <div class="prog-track">
                            <div class="prog-fill" id="simBar"></div>
                        </div>
                        <div class="prog-label">Cons: <span id="simCurrent">0</span> kcal</div>
                    </div>
                </div>

                <div class="sim-inputs">
                    <div class="input-group">
                        <label>F칩rmula / Leche HRA / RTH</label>
                        <select id="formulaSelect" class="select-modern"></select>
                    </div>
                    <div class="grid-col-2">
                        <div class="input-group">
                            <label>Volumen (ml)</label>
                            <input type="number" id="volume" placeholder="ml">
                        </div>
                        <div class="input-group">
                            <label id="lblDilution">Diluci칩n (%)</label>
                            <input type="number" id="dilution" placeholder="%">
                        </div>
                    </div>
                </div>

                <div class="macro-board">
                    <div class="macro-item k"><label>Energ칤a</label><span id="valKcal">0</span><small>kcal</small></div>
                    <div class="macro-item p"><label>Prot</label><span id="valProt">0</span><small>g</small></div>
                    <div class="macro-item c"><label>CHO</label><span id="valCHO">0</span><small>g</small></div>
                    <div class="macro-item f"><label>L칤p</label><span id="valLip">0</span><small>g</small></div>
                </div>

                <button class="btn-primary-wide" id="btnSaveHistory">Prescribir y Guardar Cloud</button>
            </section>
        </main>

        <!-- MODAL DE HISTORIAL -->
        <div class="protocol-modal" id="historyModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Historial de Pacientes</h2>
                    <button class="btn-close" id="btnHistoryClose">&times;</button>
                </div>
                <div class="history-list" id="historyContainer">
                    <p style="text-align:center; opacity:0.6;">Cargando tus registros...</p>
                </div>
            </div>
        </div>

        <!-- MODAL DE PROTOCOLOS (EXISTENTE) -->
        <div class="protocol-modal" id="protocolModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Protocolos Institucionales HRA</h2>
                    <button class="btn-close" id="btnProtocolClose">&times;</button>
                </div>
                <div class="tab-nav">
                    <button class="tab-btn active" onclick="switchProtocolTab(0)">Velocidades RTH</button>
                    <button class="tab-btn" onclick="switchProtocolTab(1)">Horarios de Entrega</button>
                </div>
                <div class="tab-content" id="tab-infusion" style="display:block;">
                    <div class="table-scroll">
                        <table>
                            <thead>
                                <tr>
                                    <th>Capacidad</th>
                                    <th>Velocidad</th>
                                    <th>Duraci칩n</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-500">
                                    <td>500 ml</td>
                                    <td>20</td>
                                    <td>24 Hrs</td>
                                </tr>
                                <tr class="bg-500">
                                    <td>500 ml</td>
                                    <td>40</td>
                                    <td>12 Hrs</td>
                                </tr>
                                <tr class="bg-1000">
                                    <td>1000 ml</td>
                                    <td>40</td>
                                    <td>24 Hrs</td>
                                </tr>
                                <tr class="bg-1000">
                                    <td>1000 ml</td>
                                    <td>80</td>
                                    <td>12 Hrs</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="tab-content" id="tab-delivery" style="display:none;">
                    <div class="table-scroll">
                        <table class="schedule-table">
                            <tr>
                                <td>Q3H</td>
                                <td>03-06-09-12-15-18-21-24</td>
                            </tr>
                            <tr>
                                <td>Q4H</td>
                                <td>06-10-14-18-22-02</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>