<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.jpg" type="image/jpeg">
    <title>SEDILE HRA | Professional Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="bg-blob blob-1"></div>
    <div class="bg-blob blob-2"></div>

    <!-- Info Protocol Button -->
    <button class="protocol-fab" id="btnProtocolOpen" title="Protocolos Institucionales">
        <span>i</span> Protocolos HRA
    </button>

    <div class="app-container compact-mode">
        <!-- HEADER COMPACTO -->
        <header class="main-header">
            <div class="brand-box">
                <img src="https://i.imgur.com/ugEhxa1.jpeg" alt="Logo" class="logo-small">
                <div>
                    <h1>SEDILE - HRA</h1>
                    <p>Calculadora Clínica V2.5</p>
                </div>
            </div>

            <div class="patient-quick-access" id="btnPatientToggle">
                <div class="p-avatar" id="currentPatientAvatar">P</div>
                <div class="p-info">
                    <span id="currentPatientName">Nuevo Paciente</span>
                    <small>IMC: <b id="valBMI">--</b> | Meta: <b id="valTMT">--</b> Kcal</small>
                </div>
            </div>
        </header>

        <main class="dashboard-grid">
            <!-- SECCIÓN 1: EVALUACIÓN (COMPACTA) -->
            <section class="card assessment-card">
                <div class="card-header">
                    <h3>Registro Evaluación</h3>
                    <button class="btn-micro" id="btnAddPatient">+ Nuevo</button>
                </div>
                <form id="form-paciente" class="compact-form">
                    <div class="input-row">
                        <input type="text" id="nombre" placeholder="Nombre completo" required>
                    </div>
                    <div class="grid-col-4">
                        <div class="mini-input">
                            <label>Edad</label>
                            <input type="number" id="edad" placeholder="0">
                        </div>
                        <div class="mini-input">
                            <label>Sexo</label>
                            <select id="sexo">
                                <option value="m">M</option>
                                <option value="f">F</option>
                            </select>
                        </div>
                        <div class="mini-input">
                            <label>Peso</label>
                            <input type="number" step="0.1" id="peso" placeholder="kg">
                        </div>
                        <div class="mini-input">
                            <label>Talla</label>
                            <input type="number" step="0.01" id="estatura" placeholder="m">
                        </div>
                    </div>
                    <div class="input-row-multi">
                        <select id="actividad" class="select-small">
                            <option value="1.2">AF: 1.2 (Reposo)</option>
                            <option value="1.3">AF: 1.3 (Ligero)</option>
                            <option value="1.5">AF: 1.5 (Mod)</option>
                        </select>
                        <button type="submit" class="btn-save-small">Guardar</button>
                    </div>
                </form>
            </section>

            <!-- SECCIÓN 2: SIMULADOR INTEGRADO -->
            <section class="card simulator-card">
                <div class="sim-header-dashboard">
                    <div class="mode-selector">
                        <button class="mode-toggle active" data-mode="vol">Vol / Dil</button>
                        <button class="mode-toggle" data-mode="grams">Gramaje</button>
                    </div>
                    <div class="progress-container-mini">
                        <div class="prog-label">Meta: <span id="simGoal">--</span> kcal</div>
                        <div class="prog-track">
                            <div class="prog-fill" id="simBar"></div>
                        </div>
                        <div class="prog-label">Cons: <span id="simCurrent">0</span> kcal</div>
                    </div>
                </div>

                <div class="sim-inputs">
                    <div class="input-group">
                        <label>Fórmula / Leche HRA / RTH</label>
                        <select id="formulaSelect" class="select-modern"></select>
                    </div>
                    <div class="grid-col-2">
                        <div class="input-group">
                            <label>Volumen (ml)</label>
                            <input type="number" id="volume" placeholder="ml">
                        </div>
                        <div class="input-group">
                            <label id="lblDilution">Dilución (%)</label>
                            <input type="number" id="dilution" placeholder="%">
                        </div>
                    </div>
                </div>

                <div class="macro-board">
                    <div class="macro-item k">
                        <label>Energía</label>
                        <span id="valKcal">0</span><small>kcal</small>
                    </div>
                    <div class="macro-item p">
                        <label>Prot</label>
                        <span id="valProt">0</span><small>g</small>
                    </div>
                    <div class="macro-item c">
                        <label>CHO</label>
                        <span id="valCHO">0</span><small>g</small>
                    </div>
                    <div class="macro-item f">
                        <label>Líp</label>
                        <span id="valLip">0</span><small>g</small>
                    </div>
                </div>

                <button class="btn-primary-wide" id="btnSaveHistory">Prescribir y Guardar Cloud</button>
            </section>
        </main>

        <!-- MODAL DE PROTOCOLOS (FLOTANTE LATERAL) -->
        <div class="protocol-modal" id="protocolModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Protocolos Institucionales HRA</h2>
                    <button class="btn-close" id="btnProtocolClose">&times;</button>
                </div>
                <div class="tab-nav">
                    <button class="tab-btn active" onclick="switchProtocolTab(0)">Velocidades RTH</button>
                    <button class="tab-btn" onclick="switchProtocolTab(1)">Horarios de Entrega</button>
                </div>

                <div class="tab-content" id="tab-infusion" style="display:block;">
                    <div class="table-scroll">
                        <h3>Guía de Infusión Continua</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Capacidad</th>
                                    <th>Velocidad (ml/h)</th>
                                    <th>Duración</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-500">
                                    <td>500 ml</td>
                                    <td>20</td>
                                    <td>24 Hrs</td>
                                </tr>
                                <tr class="bg-500">
                                    <td>500 ml</td>
                                    <td>40</td>
                                    <td>12 Hrs</td>
                                </tr>
                                <tr class="bg-500">
                                    <td>500 ml</td>
                                    <td>60</td>
                                    <td>8 Hrs</td>
                                </tr>
                                <tr class="bg-1000">
                                    <td>1000 ml</td>
                                    <td>40</td>
                                    <td>24 Hrs</td>
                                </tr>
                                <tr class="bg-1000">
                                    <td>1000 ml</td>
                                    <td>80</td>
                                    <td>12 Hrs</td>
                                </tr>
                            </tbody>
                        </table>
                        <p class="note">Hora de Entrega RTH: 14:00 - 18:00</p>
                    </div>
                </div>

                <div class="tab-content" id="tab-delivery" style="display:none;">
                    <div class="table-scroll">
                        <h3>Distribución de Fórmulas Lácteas</h3>
                        <table class="schedule-table">
                            <tr>
                                <td>Q3H (8 veces)</td>
                                <td>03-06-09-12-15-18-21-24</td>
                            </tr>
                            <tr>
                                <td>Q4H (6 veces)</td>
                                <td>06-10-14-18-22-02</td>
                            </tr>
                            <tr>
                                <td>Q6H (4 veces)</td>
                                <td>06-12-18-24</td>
                            </tr>
                            <tr>
                                <td>Régimen Licuado</td>
                                <td>06-14-22</td>
                            </tr>
                            <tr>
                                <td>Regimen Normal</td>
                                <td>07-16-22</td>
                            </tr>
                        </table>
                        <h3>Fórmulas Enterales</h3>
                        <div class="time-chips">
                            <span>08:00</span><span>10:00</span><span>16:00</span><span>22:00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden Elements for Patient Manager -->
    <div id="patientMenu" class="hidden">
        <div id="patientList"></div>
    </div>

    <script src="script.js"></script>
</body>

</html>